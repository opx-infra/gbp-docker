steps:
  - label: ":docker: stretch/amd64"
    command: |
      echo "--- Building build image"
      cd stretch-amd64
      docker build -t opxhub/gbp:stretch .
      echo "--- Building develop image"
      cd develop
      docker build -t opxhub/gbp:stretch-dev .
  - wait
  - label: ":docker: push"
    branches: "master"
    command: |
      echo "--- Pushing docker images"
      docker tag opxhub/gbp:stretch "opxhub/gbp:$(git rev-parse HEAD)"
      docker push "opxhub/gbp:$(git rev-parse HEAD)"
      docker push opxhub/gbp:stretch
      docker tag opxhub/gbp:stretch-dev "opxhub/gbp:$(git rev-parse HEAD)-dev"
      docker push "opxhub/gbp:$(git rev-parse HEAD)-dev"
      docker push opxhub/gbp:stretch-dev
